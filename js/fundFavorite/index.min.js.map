{"version":3,"sources":["fundFavorite/index.js"],"names":["ajaxLoadCompany","deferred","$","Deferred","ajax","url","Constants","getFundCompanyUrl","type","done","response","companyObject","_","zipObject","map","sessionStorage","setItem","JSON","stringify","resolve","promise","ajaxLoadFundNetWorth","favlist","parse","getItem","console","log","postdata","fundcode","join","getFundNetWorthUrl","data","fundNetWorthList","fundsData","groupedFundsData","fundCompanyHtml","each","index","fundNetWorthItem","Funds","fundsItem","push","groupBy","keys","fundCompanyId","fundsHtml","fmtNetWorthDate","Date","NetWorthDate","format","FundId","FundShortName","MoneyTypeName","NetWorth","cxRise","RiseAndDecline","removeClass","length","addClass","html","listFavoriteCallback","_favlist","App","StopLoading","document","on","event","this","location","href","StartLoading","loadWarning","setTimeout","ListFavorite"],"mappings":"AAAA,QAASA,mBACP,GAAIC,GAAWC,EAAEC,UASjB,OARAD,GAAEE,MACEC,IAAKC,UAAUC,oBACfC,KAAK,QACNC,KAAK,SAASC,GAChB,GAAIC,GAAiBC,EAAEC,UAAUD,EAAEE,IAAIJ,EAAU,aAAcE,EAAEE,IAAIJ,EAAU,gBAC/EK,gBAAeC,QAAQ,gBAAgBC,KAAKC,UAAUP,IACtDV,EAASkB,YAEHlB,EAASmB,UAGlB,QAASC,sBAAqBC,GAE5B,GAAIrB,GAAWC,EAAEC,WAEbQ,EAAgBM,KAAKM,MAAMR,eAAeS,QAAQ,iBACtDC,SAAQC,IAAI,gBAAgBf,EAE5B,IAAIgB,KA2DJ,OA1DAA,GAASC,SAAWN,EAAQO,KAAK,KACjC3B,EAAEE,MACEC,IAAKC,UAAUwB,qBACftB,KAAK,MACLuB,KAAKJ,IACNlB,KAAK,SAASC,GACb,GAAIsB,GAAmBtB,EACnBuB,KACAC,KACAC,IACJjC,GAAEkC,KAAKJ,EAAkB,SAASK,EAAMC,GACtCpC,EAAEkC,KAAKE,EAAiBC,MAAM,SAASF,EAAMG,GACzCP,EAAUQ,KAAKD,OAGrBf,QAAQC,IAAI,YAAYO,GACxBC,EAAmBtB,EAAE8B,QAAQT,EAAU,aAEvC/B,EAAEkC,KAAKxB,EAAE+B,KAAKT,GAAmB,SAASG,EAAMO,GAC9C,GAAIC,KACJ3C,GAAEkC,KAAKF,EAAiBU,GAAe,SAASP,EAAMG,GAEpD,GAAIM,GAAmBN,EAAsB,aAAI,GAAIO,MAAKP,EAAUQ,cAAcC,OAAO,SAAW,KAEpGJ,GAAUJ,KAAK,wCAA0CD,EAAUU,OAAS,KAC5EL,EAAUJ,KAAK,yBAA2BD,EAAUW,cAAiB,SACrEN,EAAUJ,KAAK,OAASD,EAAUY,cAAiB,SACnDP,EAAUJ,KAAK,QACfI,EAAUJ,KAAK,4BAA8BD,EAAUa,SAAY,UACnER,EAAUJ,KAAK,kCAAoCK,EAAkB,WACrED,EAAUJ,KAAK,SACfI,EAAUJ,KAAK,QACfI,EAAUJ,KAAK,kBAAoBvC,EAAEoD,OAAOd,EAAUe,gBAAmB,KAAOf,EAAUe,eAAiB,WAC3GV,EAAUJ,KAAK,SACfI,EAAUJ,KAAK,+BACfI,EAAUJ,KAAK,cAEjBN,EAAgBM,KAAK,8BACrBN,EAAgBM,KAAK,OAAS9B,EAAciC,GAAiB,QAC7DT,EAAgBM,KAAK,UACrBN,EAAgBM,KAAK,6BACrBN,EAAgBM,KAAK,YACrBN,EAAgBM,KAAK,sIACrBN,EAAgBM,KAAK,aACrBN,EAAgBM,KAAOI,EAAUhB,KAAK,MACtCM,EAAgBM,KAAK,cAGvBvC,EAAE,iBAAiBsD,cAChBrB,GAAmBA,EAAgBsB,OAAS,EAC7CvD,EAAE,iBAAiBwD,SAAS,YAAYC,KAAKxB,EAAgBN,KAAK,MAElE3B,EAAE,iBAAiByD,KAAK,+GAG1B1D,EAASkB,YAGNlB,EAASmB,UAIlB,QAASwC,sBAAqBC,GAC7B,GAAIvC,GAAUuC,KACb7D,mBAAkBS,KAAK,WACrBY,qBAAqBC,GAASb,KAAK,WACjCqD,IAAIC,kBAKV7D,EAAE8D,UAAUC,GAAG,SAAS,aAAa,SAASC,GAC1CnD,eAAeC,QAAQ,SAASd,EAAEiE,MAAMpC,KAAK,WAC7CqC,SAASC,KAAO,gCAGpBnE,EAAE8D,UAAUC,GAAI,WAAY,iBAAkB,SAASC,GAErDJ,IAAIQ,eAEJpE,EAAE,mBAAmBqE,cAIrBC,WAAWV,IAAIW,eAAe","file":"fundFavorite/index.min.js","sourcesContent":["function ajaxLoadCompany(){\n  var deferred = $.Deferred();\n  $.ajax({\n      url: Constants.getFundCompanyUrl(),\n      type:\"GET\"\n  }).done(function(response){\n   var companyObject =  _.zipObject(_.map(response, 'CompanyId'), _.map(response, 'CompanyShort'));\n   sessionStorage.setItem(\"companyObject\",JSON.stringify(companyObject));\n   deferred.resolve();\n  });\n  return deferred.promise();\n}\n\nfunction ajaxLoadFundNetWorth(favlist){\n\n  var deferred = $.Deferred();\n\n  var companyObject = JSON.parse(sessionStorage.getItem(\"companyObject\"));\n  console.log(\"companyObject\",companyObject);\n\n  var postdata = {};\n  postdata.fundcode = favlist.join(\",\");\n  $.ajax({\n      url: Constants.getFundNetWorthUrl(),\n      type:\"GET\",\n      data:postdata\n  }).done(function(response){\n      var fundNetWorthList = response,\n          fundsData = [],\n          groupedFundsData = {},\n          fundCompanyHtml=[];\n      $.each(fundNetWorthList, function(index,fundNetWorthItem) {\n        $.each(fundNetWorthItem.Funds,function(index,fundsItem){\n            fundsData.push(fundsItem);\n        });\n      });\n      console.log(\"fundsData\",fundsData);\n      groupedFundsData = _.groupBy(fundsData,'CompanyId');\n\n      $.each(_.keys(groupedFundsData), function(index,fundCompanyId) {\n        var fundsHtml = [];\n        $.each(groupedFundsData[fundCompanyId],function(index,fundsItem){\n\n          var fmtNetWorthDate = (fundsItem.NetWorthDate) ? new Date(fundsItem.NetWorthDate).format(\"mm/dd\") : \"N/A\";\n          \n          fundsHtml.push(\"<tbody class='fund-item' data-fundid=\" + fundsItem.FundId  +\">\");\n          fundsHtml.push(\"<td class='shortname'>\" + fundsItem.FundShortName  + \"</td>\");\n          fundsHtml.push(\"<td>\" + fundsItem.MoneyTypeName  + \"</td>\");\n          fundsHtml.push(\"<td>\");\n          fundsHtml.push(\"  <div class='net-worth'>\" + fundsItem.NetWorth  + \"</div>\");\n          fundsHtml.push(\"  <div class='net-worth-date'>(\" + fmtNetWorthDate + \")</div>\");\n          fundsHtml.push(\"</td>\");\n          fundsHtml.push(\"<td>\");\n          fundsHtml.push(\"  <span class='\" + $.cxRise(fundsItem.RiseAndDecline) +  \"'>\" + fundsItem.RiseAndDecline + \"</span>\");\n          fundsHtml.push(\"</td>\");\n          fundsHtml.push(\"<td class='indicator'></td>\");\n          fundsHtml.push(\"</tbody>\");\n        });\n        fundCompanyHtml.push(\"<div data-role='headline'>\");\n        fundCompanyHtml.push(\" <p>\" + companyObject[fundCompanyId] + \"</p>\");\n        fundCompanyHtml.push(\"</div>\");\n        fundCompanyHtml.push(\"<table data-role='table'>\");\n        fundCompanyHtml.push(\" <thead>\");\n        fundCompanyHtml.push(\"   <th>基金名稱</th><th>幣別</th><th>最新<br>淨值</th><th>漲跌幅</th><th></th>\");\n        fundCompanyHtml.push(\" </thead>\");\n        fundCompanyHtml.push(  fundsHtml.join(\" \"));        \n        fundCompanyHtml.push(\"</table>\");\n      });\n\n      $(\"#result-block\").removeClass();\n      if(fundCompanyHtml && fundCompanyHtml.length > 0){\n        $(\"#result-block\").addClass('has-data').html(fundCompanyHtml.join(\" \"));\n      }else{\n        $(\"#result-block\").html(\"<div class='no-result'>目前沒有已加入最愛的基金。</div>\");\n      }\n\n      deferred.resolve();\n  });\n\n  return deferred.promise();    \n\n}\n\nfunction listFavoriteCallback(_favlist){\n\tvar favlist = _favlist || [];\n  ajaxLoadCompany().done(function(){\n    ajaxLoadFundNetWorth(favlist).done(function(){\n      App.StopLoading();\n    });\n  });\n}\n\n$(document).on(\"vclick\",\".fund-item\",function(event){\n    sessionStorage.setItem(\"fundid\",$(this).data(\"fundid\"));\n    location.href = \"../html/singleFundInfo.html\";\n});\n\n$(document).on( \"pageinit\", \"#page-fund-fav\", function(event) {\n\n  App.StartLoading();    \n\n  $(\".numura-warning\").loadWarning();\n\n  //setTimeout(listFavoriteCallback([\"INGIGHD\",\"21\"]),3000);\n\n  setTimeout(App.ListFavorite(),3000);\n\n  // $.when(ajaxLoadFundNetWorth()).done(function(){\n  //   App.StopLoading();\n  // });\n\n});"],"sourceRoot":"/source/"}