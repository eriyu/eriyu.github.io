{"version":3,"sources":["fundDividendTable/index.js"],"names":["ajaxFundDividendTable","deferred","$","Deferred","postdata","companyId","filterXSS","sessionStorage","getItem","val","typeId","dividendYear","_","isEmpty","keyword","ajax","url","Constants","getFundDividendTableUrl","type","data","done","response","fundDividendList","fundTypeHtml","each","index","fundDividendItem","dividendsHtml","cxBgcolor","MoneyTypeId","toLowerCase","Dividends","dividendsItem","dividendDate","Date","DividendDate","fmtDividendDate","format","cxCurrent","push","DividendPerUnit","MonthDividendRate","MonthReturnRate","YearDividendRate","FundId","FundShortName","MoneyTypeName","join","removeClass","length","addClass","html","shortnameHeight","this","find","outerHeight","css","resolve","promise","document","on","envent","nowyear","getFullYear","lastYear","dLoadCompany","dLoadType","App","StartLoading","loadWarning","empty","append","value","text","selected","selectmenu","loadSelectFundCompany","success","failure","reject","loadSelectFundType","includeFundTypeAll","when","then","StopLoading","event","setItem","location","href","pattern","test","ShowAlert"],"mappings":"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","file":"fundDividendTable/index.min.js","sourcesContent":["function ajaxFundDividendTable (){\n  var deferred = $.Deferred();\n\n  var postdata = {};\n  postdata.companyId = filterXSS(sessionStorage.getItem(\"fundCompany\")) || $(\"#select-company\").val();\n  postdata.typeId = filterXSS(sessionStorage.getItem(\"fundType\")) || $(\"#select-type\").val();\n  postdata.dividendYear = filterXSS(sessionStorage.getItem(\"fundYear\")) || $(\"#select-year\").val();\n  if(!_.isEmpty(sessionStorage.getItem(\"fundKeyword\"))){\n    postdata.keyword = sessionStorage.getItem(\"fundKeyword\") || $(\"#input-keyword\").val();\n  }\n\n  $.ajax({\n      url: Constants.getFundDividendTableUrl(),\n      type:\"GET\",\n      data:postdata\n  }).done(function(response){\n    var fundDividendList = response,\n        fundTypeHtml = [];\n    $.each(fundDividendList, function(index,fundDividendItem) {\n\n      var dividendsHtml = [],\n      cxBgcolor = \"bgcolor-\" + fundDividendItem.MoneyTypeId.toLowerCase();\n      \n      if(_.isEmpty(fundDividendItem.Dividends)) return; // continue\n\n      $.each(fundDividendItem.Dividends,function(index,dividendsItem){\n        var dividendDate = new Date(dividendsItem.DividendDate),\n            fmtDividendDate = dividendDate.format(\"yyyy/mm\"),\n            cxCurrent = (index === 0) ? \"current\" : \"\";\n        dividendsHtml.push(\"<tbody class='\" + cxCurrent + \"'>\");\n        dividendsHtml.push(\"  <td>\" + fmtDividendDate + \"</td>\");\n        dividendsHtml.push(\"  <td>\" + dividendsItem.DividendPerUnit + \"</td>\");\n        dividendsHtml.push(\"  <td>\" + dividendsItem.MonthDividendRate + \"</td>\");\n        dividendsHtml.push(\"  <td>\" + dividendsItem.MonthReturnRate + \"</td>\");\n        dividendsHtml.push(\"  <td>\" + dividendsItem.YearDividendRate + \"</td>\");\n        dividendsHtml.push(\"</tbody>\");\n      }); // end each fundDividendItem.Dividends\n\n      fundTypeHtml.push(\"<div class='js-fund-item' data-fundid='\" + fundDividendItem.FundId + \"''>\");\n      fundTypeHtml.push(\"<div data-role='headline'>\");\n      fundTypeHtml.push(\" <div class='shortname'>\" + fundDividendItem.FundShortName + \"</div>\");\n      fundTypeHtml.push(\"</div>\");\n      fundTypeHtml.push(\"<div data-role='moneytype'>\");\n      fundTypeHtml.push(\" <div class='item \" + cxBgcolor + \"'>\" + fundDividendItem.MoneyTypeName + \"</div>\");\n      fundTypeHtml.push(\"</div>\");        \n      fundTypeHtml.push(\"<table data-role='table'>\");\n      fundTypeHtml.push(\" <thead>\");\n      fundTypeHtml.push(\"   <th>配息<br>期間</th>\");\n      fundTypeHtml.push(\"   <th>每單位<br>配息<br>金額</th>\");\n      fundTypeHtml.push(\"   <th>當月<br>配息率<br>(%)</th>\");\n      fundTypeHtml.push(\"   <th>當月<br>報酬率<br>(含息)%</th>\");\n      fundTypeHtml.push(\"   <th>年化<br>配息率<br>(%)</th>\");\n      fundTypeHtml.push(\" </thead>\");\n      fundTypeHtml.push(  dividendsHtml.join(\" \"));        \n      fundTypeHtml.push(\"</table>\");\n      fundTypeHtml.push(\"</div>\");\n\n    }); // end each fundDividendList\n\n    $(\"#result-block\").removeClass();\n    if(fundTypeHtml && fundTypeHtml.length > 0){\n      $(\"#result-block\").addClass('has-data').html(fundTypeHtml.join(\" \"));\n    }else{\n      $(\"#result-block\").addClass('empty-data').html(\"<div class='no-dividend'>無配息資料</div>\");\n    }\n\n    $(\"#result-block [data-role=headline]\").each(function(index){\n        var shortnameHeight = $(this).find(\".shortname\").outerHeight(true);\n        $(this).css(\"height\",shortnameHeight);\n    });\n\n    deferred.resolve();\n\n  });\n\n  return deferred.promise();\n}\n\n\n$(document).on( \"pageinit\", \"#page-fund-dividend\", function(envent) {\n\n\tvar nowyear = new Date().getFullYear(),\n      lastYear = nowyear - 1; \n\n  //使用Derffered Ojbect讓資料載入後，再解除Loading\n  var dLoadCompany = $.Deferred(),\n      dLoadType = $.Deferred();\n\n  App.StartLoading();  \n\n  $(\".numura-warning\").loadWarning();\n\n  $(\"#input-keyword\").val(sessionStorage.getItem(\"fundKeyword\"));    \n\n\t$(\"#select-year\")\n\t.empty()\n\t.append($('<option>', { value:lastYear,text :lastYear }))\n\t.append($('<option>', { value : nowyear,text :nowyear,selected:true }))\n\t.selectmenu(\"refresh\",true)\n  .val(nowyear); \n\n  $(\"#select-company\").loadSelectFundCompany(\n    {\n      \"success\":function(){\n        dLoadCompany.resolve(\"success\");\n      },\"failure\":function(){\n        dLoadCompany.reject(\"failure\");\n      }\n    }\n  );\n\n  $(\"#select-type\").loadSelectFundType(\n    {\n      \"includeFundTypeAll\":false,\n      \"success\":function(){\n        dLoadType.resolve(\"success\");\n      },\"failure\":function(){\n        dLoadType.reject(\"failure\");\n      }      \n    }\n  );\n\n  $.when(dLoadCompany,dLoadType)\n    .then(function(){\n      if(sessionStorage.getItem(\"fundCompany\")){\n        $(\"#select-company\")\n          .val(sessionStorage.getItem(\"fundCompany\"))\n          .selectmenu(\"refresh\",true);\n      }\n      if(sessionStorage.getItem(\"fundType\")){\n        $(\"#select-type\")\n          .val(sessionStorage.getItem(\"fundType\"))\n          .selectmenu(\"refresh\",true);\n      }\n      if(sessionStorage.getItem(\"fundYear\")){\n        $(\"#select-year\")\n          .val(sessionStorage.getItem(\"fundYear\"))\n          .selectmenu(\"refresh\",true);\n      }      \n      //ajaxFundDividendTable();\n      // $.when(ajaxFundDividendTable()).done(function(){\n      //   App.StopLoading();\n      // });      \n    }).done(function(){\n      App.StopLoading();\n  });\n\n});\n\n$(document).on(\"vclick\",\".js-fund-item\",function(event){\n  sessionStorage.setItem(\"fundid\",$(this).data(\"fundid\"));\n  location.href = \"../html/singleFundInfo.html\";\n});\n\n$(document).on(\"vclick\",\"#btn-submit\",function(event){\n  var pattern = /^[A-z0-9 \\u4e00-\\u9fa5]+$/;\n  var keyword = $(\"#input-keyword\").val();\n  if(keyword.length > 0 && !pattern.test(keyword)){\n    App.ShowAlert('請勿輸入符號或全形英數',\"\",\"確定\");\n    return false;\n  }\n\n  sessionStorage.setItem(\"fundCompany\",$(\"#select-company\").val());\n  sessionStorage.setItem(\"fundType\",$(\"#select-type\").val());\n  sessionStorage.setItem(\"fundYear\",$(\"#select-year\").val());\n  sessionStorage.setItem(\"fundKeyword\",keyword);\n\n  App.StartLoading(); \n  \n  $.when(ajaxFundDividendTable()).done(function(){\n      App.StopLoading();\n  });\n  \n});"],"sourceRoot":"/source/"}