{"version":3,"sources":["fundNetWorth/singleFundNetWorth.js"],"names":["ajaxLoadChartAndFundTrendData","deferred","$","Deferred","postdata","interval","filterXSS","sessionStorage","getItem","fundCode","getDefaultInterval","ajax","url","Constants","getSingleFundIntervalNetWorthUrl","type","data","done","response","FundInfo","dayNetWorths","dayNetWorthTicks","yScalesNetWorth","NetWorthYScales","dayNetWorthIntervals","_","pluck","DayNetWorthIntervals","fmtHighestNetWorthDate","Date","HighestNetWorthDate","format","fmtLowestNetWorthDate","LowestNetWorthDate","loadMaxAndMinValueTable","tableCaption","maxValue","HighestNetWorth","maxValueDate","minValue","LowestNetWorth","minValueDate","removeClass","isEmpty","DayNetWorths","html","addClass","resolve","promise","push","each","index","item","xTickValue","parseFloat","NetWorth","includes","NetWorthDate","result","find","v","f","drawChart","fail","jqXHR","reject","responseJSON","Message","google","visualization","arrayToDataTable","options","title","hAxis","textStyle","fontSize","ticks","vAxis","colors","legend","position","chartArea","width","backgroundColor","stroke","strokeWidth","tooltip","trigger","chart","AreaChart","document","getElementById","draw","ajaxLoadSingleFundNetWorth","fundId","getSingleFundNetWorthUrl","riseAndDropHtml","rnwTable","thead","tbody","fmtNetWorthDate","fmtToNowNetWorthHighDate","ToNowNetWorthHighDate","fmtToNowNetWorthLowDate","ToNowNetWorthLowDate","setItem","FundCode","FundShortName","loadMoneyType","MoneyDividendTypes","css","padding-top","outerHeight","loadSelectMoneyDividendTypes","moneyDividendTypes","selectedValue","FundId","loadFundIntervals","optionCaption","optionDivider","ToNowNetWorthHigh","ToNowNetWorthLow","cxRise","RiseAndDrop","RiseAndDecline","join","RecentlyNetWorths","reverse","value","length","unshift","load","packages","setOnLoadCallback","on","event","App","StartLoading","this","val","when","StopLoading","msg","ShowAlert","then","loadWarning","removeItem"],"mappings":"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","file":"fundNetWorth/singleFundNetWorth.min.js","sourcesContent":["\n// Load the Visualization API and the piechart package.\ngoogle.load('visualization', '1', {'packages':['corechart']});\n\n// Set a callback to run when the Google Visualization API is loaded.\ngoogle.setOnLoadCallback(ajaxLoadChartAndFundTrendData);\n\nfunction ajaxLoadChartAndFundTrendData(){\n  //console.log(\"ajaxLoadChartAndFundTrendData\");\n  var deferred = $.Deferred();\n  var postdata = {};\n  var interval = filterXSS(sessionStorage.getItem(\"interval\"));\n  postdata.fundCode = filterXSS(sessionStorage.getItem(\"fundCode\"));\n  postdata.interval = (interval) ? interval : $.getDefaultInterval();\n  //console.log(\"postdata ==>\",postdata);\n  $.ajax({\n    url: Constants.getSingleFundIntervalNetWorthUrl(),\n        type:\"GET\",\n        data:postdata\n    }).done(function(response){\n      var FundInfo = response;\n      var dayNetWorths = [],\n          dayNetWorthItem = [],\n          dayNetWorthTicks = [],\n          yScalesNetWorth = FundInfo.NetWorthYScales;\n\n      var dayNetWorthIntervals = _.pluck(FundInfo.DayNetWorthIntervals,'Key');\n\n      var fmtHighestNetWorthDate = (FundInfo.HighestNetWorthDate) ? (new Date(FundInfo.HighestNetWorthDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n      var fmtLowestNetWorthDate = (FundInfo.LowestNetWorthDate) ? (new Date(FundInfo.LowestNetWorthDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n\n      $(\"#tableIntervalNetWorth\").loadMaxAndMinValueTable({\n        'tableCaption':'選取範圍淨值',\n        'maxValue':FundInfo.HighestNetWorth,\n        'maxValueDate' : fmtHighestNetWorthDate,\n        'minValue' : FundInfo.LowestNetWorth,\n        'minValueDate' : fmtLowestNetWorthDate,\n      });\n\n      $(\"#fund-chart\").removeClass();\n      if(_.isEmpty(FundInfo.DayNetWorths)){\n        $(\"#fund-chart\").html(\"目前暫無資料\").addClass(\"empty-data\");\n        deferred.resolve();\n        return deferred.promise();\n      }\n\n      dayNetWorths.push(['NetWorthDate','NetWorth']);\n\n      $.each(FundInfo.DayNetWorths, function(index, item) {\n        var xTickValue = \"\";\n        var yTickValue = \"\";\n        dayNetWorths.push([\n            index,\n            parseFloat(item.NetWorth)\n        ]);\n        if(_.includes(dayNetWorthIntervals,item.NetWorthDate)){\n          xTickValue = _.result(_.find(FundInfo.DayNetWorthIntervals,'Key',item.NetWorthDate),'Value');\n          dayNetWorthTicks.push(\n            {\n              v:index,\n              f:\"\"+xTickValue\n            }\n          );\n        }\n      });\n      drawChart(dayNetWorths,dayNetWorthTicks,yScalesNetWorth);\n      deferred.resolve();\n    }).fail(function(jqXHR){\n      deferred.reject(jqXHR.responseJSON.Message);\n    }); \n  return deferred.promise();\n}\n\nfunction drawChart(dayNetWorths,dayNetWorthTicks,yScalesNetWorth) {\n\n  var data = google.visualization.arrayToDataTable(dayNetWorths);\n\n  var options = {\n    title: '',\n    hAxis: {textStyle:{fontSize:8},ticks:dayNetWorthTicks},\n    //vAxis: {textStyle:{fontSize:8},minValue: 0,format:'#0.0'},\n    vAxis: {textStyle:{fontSize:8},ticks:yScalesNetWorth},\n    colors:['#CC0000'],\n    legend:{position:'none'},\n    chartArea:{\n      width:260,\n      backgroundColor:{\n        stroke:'#000000',\n        strokeWidth:'1'\n      }\n    },\n    tooltip:{\n      trigger:'none'\n    }\n  };\n\n  var chart = new google.visualization.AreaChart(document.getElementById(\"fund-chart\"));\n  chart.draw(data, options);\n}\n      \nfunction ajaxLoadSingleFundNetWorth(){\n  //console.log(\"ajaxLoadSingleFundNetWorth\");\n  var deferred = $.Deferred();\n  var postdata = {};\n  postdata.fundId = filterXSS(sessionStorage.getItem(\"fundid\"));\n\t$.ajax({\n\t\turl: Constants.getSingleFundNetWorthUrl(),\n      \ttype:\"GET\",\n      \tdata:postdata\n  \t}).done(function(response){\n  \t\tvar FundInfo = response;\n      var riseAndDropHtml = [],\n          rnwTable = {'thead':[],'tbody':[],'html':''};\n\n      var fmtNetWorthDate = (FundInfo.NetWorthDate) ? (new Date(FundInfo.NetWorthDate)).format(\"mm/dd\") : \"N/A\";\n      var fmtToNowNetWorthHighDate = (FundInfo.ToNowNetWorthHighDate) ? (new Date(FundInfo.ToNowNetWorthHighDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n      var fmtToNowNetWorthLowDate = (FundInfo.ToNowNetWorthLowDate) ? (new Date(FundInfo.ToNowNetWorthLowDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n      //console.log(\"ajaxLoadSingleFundNetWorth done\");\n      sessionStorage.setItem(\"fundCode\",FundInfo.FundCode);\n\n  \t\t$(\"#shortname\").html(FundInfo.FundShortName);\n  \t\t$(\"[data-role='moneytype']\").loadMoneyType(FundInfo.MoneyDividendTypes);\n\n      $(\"[data-role='page']\").css({\n        \"padding-top\":$(\"[data-role='header']\").outerHeight(true) + \"px\"\n      });\n\n      $(\"#select-fund\").loadSelectMoneyDividendTypes({\n        'moneyDividendTypes':FundInfo.MoneyDividendTypes,\n        'selectedValue':FundInfo.FundId\n      });\n      $(\"#select-interval\").loadFundIntervals({\n        'optionCaption' : '淨值走勢',\n        'optionDivider' : '-'\n      });\n\n      $(\"#tableToNowNetWorth\").loadMaxAndMinValueTable({\n        'tableCaption':'成立至今淨值',\n        'maxValue':FundInfo.ToNowNetWorthHigh,\n        'maxValueDate' : fmtToNowNetWorthHighDate,\n        'minValue' : FundInfo.ToNowNetWorthLow,\n        'minValueDate' : fmtToNowNetWorthLowDate,       \n      });    \n\n      riseAndDropHtml.push(\" <thead>\");\n      riseAndDropHtml.push(\"   <th>最新淨值</th><th>較前一日<br>漲跌</th><th>較前一日<br>漲跌幅(%)</th>\");\n      riseAndDropHtml.push(\" </thead>\");\n      riseAndDropHtml.push(\" <tbody>\");\n      riseAndDropHtml.push(\"  <td>\");\n      riseAndDropHtml.push(\"    <div class='net-worth \" + $.cxRise(FundInfo.NetWorth) +  \"'>\" + FundInfo.NetWorth + \"</div>\");\n      riseAndDropHtml.push(\"    <div class='net-worth-date'>(\" + fmtNetWorthDate + \")</div>\");\n      riseAndDropHtml.push(\"  </td>\");\n      riseAndDropHtml.push(\"  <td>\");\n      riseAndDropHtml.push(\"    <span class='\" + $.cxRise(FundInfo.RiseAndDrop) +  \"'>\" + (FundInfo.RiseAndDrop || \"N/A\") + \"</span>\");\n      riseAndDropHtml.push(\"  </td>\");\n      riseAndDropHtml.push(\"  <td>\");\n      riseAndDropHtml.push(\"    <span class='\" + $.cxRise(FundInfo.RiseAndDecline) +  \"'>\" + (FundInfo.RiseAndDecline || \"N/A\") + \"</span>\");\n      riseAndDropHtml.push(\"  </td>\");\n      riseAndDropHtml.push(\" </tbody>\");               \n      $(\"#tableRiseAndDrop\").html(riseAndDropHtml.join(\" \"));\n\n      _(FundInfo.RecentlyNetWorths).reverse().value();\n\n      $.each(FundInfo.RecentlyNetWorths, function(index, item) {\n        var fmtNetWorthDate = (item.NetWorthDate) ? (new Date(item.NetWorthDate)).format(\"mm/dd\") : \"N/A\";\n        rnwTable.thead.push(\" <th>\" + fmtNetWorthDate + \"</th>\");\n        rnwTable.tbody.push(\" <td>\" + item.NetWorth + \"</td>\");\n      });\n\n      if(FundInfo.RecentlyNetWorths && FundInfo.RecentlyNetWorths.length > 0){\n        rnwTable.thead.unshift(\"<thead>\");\n        rnwTable.thead.push(\"</thead>\");\n        rnwTable.tbody.unshift(\"<tbody>\");\n        rnwTable.tbody.push(\"</tbody>\");        \n        rnwTable.html = rnwTable.thead.join(\" \") + rnwTable.tbody.join(\" \");      \n      }else{\n        rnwTable.html = \"<div class='empty-data'>N/A</div>\";\n      }\n      $(\"#tableRecentlyNetWorth\").html(rnwTable.html);\n      deferred.resolve();\n\t  }).fail(function(jqXHR){\n      deferred.reject(jqXHR.responseJSON.Message);\n    }); \n  return deferred.promise();\t\n}\n\n$(document).on(\"change\",\"#select-interval\",function(event){\n  App.StartLoading();\n  sessionStorage.setItem(\"interval\",$(this).val());\n  $.when(ajaxLoadChartAndFundTrendData()).done(function(){\n    App.StopLoading();\n  }).fail(function(msg){\n    App.ShowAlert(msg,\"\",\"確定\",function(){\n      App.StopLoading();\n    });\n  });\n});\n\n$(document).on(\"change\",\"#select-fund\",function(event){\n\n  // console.log(\"change\");\n  \n  App.StartLoading();\n\n  sessionStorage.setItem(\"fundid\",$(this).val()); \n\n  ajaxLoadSingleFundNetWorth()\n    .then(function(){\n      ajaxLoadChartAndFundTrendData();\n    })\n    .done(function(){\n      App.StopLoading();\n    })\n    .fail(function(msg){\n      App.ShowAlert(msg,\"\",\"確定\",function(){\n        App.StopLoading();\n      });\n    });\n\n});\n\n$(document).on( \"pageinit\", \"#page-sfnw\", function(event) {\n\n  App.StartLoading(); \n\n  $(\".numura-warning\").loadWarning(); \n\n  sessionStorage.removeItem(\"interval\");\n\n  ajaxLoadSingleFundNetWorth()\n    .then(function(){\n      ajaxLoadChartAndFundTrendData();\n    })\n    .done(function(){\n      App.StopLoading();\n    })\n    .fail(function(msg){\n      App.ShowAlert(msg,\"\",\"確定\",function(){\n        App.StopLoading();\n      });\n    });\n\n});"],"sourceRoot":"/source/"}