{"version":3,"sources":["fundNetWorth/singleFundAchievement.js"],"names":["ajaxLoadChartAndFundReturnRateData","deferred","$","Deferred","postdata","interval","filterXSS","sessionStorage","getItem","fundCode","getDefaultInterval","ajax","url","Constants","getSingleFundIntervalReturnRateUrl","type","data","done","response","FundInfo","dayReturnRates","dayReturnRateTicks","dayReturnRateIntervals","_","pluck","DayReturnRateIntervals","fmtHighestReturnRateDate","Date","HighestReturnRateDate","format","fmtLowestReturnRateDate","LowestReturnRateDate","loadMaxAndMinValueTable","tableCaption","maxValue","HighestReturnRate","maxValueDate","minValue","LowestReturnRate","minValueDate","removeClass","isEmpty","DayReturnRates","html","addClass","resolve","promise","push","each","index","item","tickValue","parseFloat","ReturnRate","includes","ReturnRateDate","result","find","v","f","drawChart","fail","jqXHR","reject","responseJSON","Message","google","visualization","arrayToDataTable","options","title","hAxis","textStyle","fontSize","ticks","vAxis","colors","legend","position","chartArea","width","backgroundColor","stroke","strokeWidth","tooltip","trigger","chart","AreaChart","document","getElementById","draw","ajaxLoadSingleFundAchievement","fundId","getSingleFundAchievementUrl","fmtFromEstablishHighestDate","FromEstablishHighestDate","fmtFromEstablishLowestDate","FromEstablishLowestDate","setItem","FundCode","FundShortName","loadMoneyType","MoneyDividendTypes","css","padding-top","outerHeight","loadSelectMoneyDividendTypes","moneyDividendTypes","selectedValue","FundId","loadFundIntervals","optionCaption","optionDivider","$this","this","table","thead","tbody","tableKey","dataTable","getAchievementMapping","content","Key","Caption","cxRise","unshift","join","FromEstablishHighest","FromEstablishLowest","load","packages","setOnLoadCallback","on","event","App","StartLoading","val","when","StopLoading","msg","ShowAlert","then","loadWarning"],"mappings":"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","file":"fundNetWorth/singleFundAchievement.min.js","sourcesContent":["\n// Load the Visualization API and the piechart package.\ngoogle.load('visualization', '1', {'packages':['corechart']});\n\n// Set a callback to run when the Google Visualization API is loaded.\ngoogle.setOnLoadCallback(ajaxLoadChartAndFundReturnRateData);\n\nfunction ajaxLoadChartAndFundReturnRateData(){\n  var deferred = $.Deferred();\n  var postdata = {};\n  var interval = filterXSS(sessionStorage.getItem(\"interval\"));\n  postdata.fundCode = filterXSS(sessionStorage.getItem(\"fundCode\"));\n  postdata.interval = (interval) ? interval : $.getDefaultInterval();\n  $.ajax({\n    url: Constants.getSingleFundIntervalReturnRateUrl(),\n        type:\"GET\",\n        data:postdata\n    }).done(function(response){\n      var FundInfo = response;\n      var dayReturnRates = [],\n          dayReturnRateItem = [],\n          dayReturnRateTicks = [];\n\n      var dayReturnRateIntervals = _.pluck(FundInfo.DayReturnRateIntervals,'Key');\n\n      var fmtHighestReturnRateDate = (FundInfo.HighestReturnRateDate) ? (new Date(FundInfo.HighestReturnRateDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n      var fmtLowestReturnRateDate = (FundInfo.LowestReturnRateDate) ? (new Date(FundInfo.LowestReturnRateDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n     \n      $(\"#tableIntervalReturnRate\").loadMaxAndMinValueTable({\n        'tableCaption':'區間內報酬率(%)',\n        'maxValue':FundInfo.HighestReturnRate,\n        'maxValueDate' : fmtHighestReturnRateDate,\n        'minValue' : FundInfo.LowestReturnRate,\n        'minValueDate' : fmtLowestReturnRateDate       \n      });\n\n      $(\"#fund-chart\").removeClass();\n      if(_.isEmpty(FundInfo.DayReturnRates)){\n        $(\"#fund-chart\").html(\"目前暫無資料\").addClass(\"empty-data\");\n        deferred.resolve();\n        return deferred.promise();\n      }            \n\n      dayReturnRates.push(['NetWorthDate','NetWorth']);\n\n      $.each(FundInfo.DayReturnRates, function(index, item) {\n        var tickValue = \"\";\n        dayReturnRates.push([\n            index,\n            parseFloat(item.ReturnRate)\n        ]);\n        if(_.includes(dayReturnRateIntervals,item.ReturnRateDate)){\n          tickValue = _.result(_.find(FundInfo.DayReturnRateIntervals,'Key',item.ReturnRateDate),'Value');\n          dayReturnRateTicks.push(\n            {\n              v:index,\n              f:\"\"+tickValue\n            }\n          );\n        }\n      });          \n      drawChart(dayReturnRates,dayReturnRateTicks);\n      deferred.resolve();\n    }).fail(function(jqXHR){\n      // console.log(arguments);\n      // console.log(jqXHR.responseJSON.Message);\n      deferred.reject(jqXHR.responseJSON.Message);\n    });\n  return deferred.promise();\n}\n\nfunction drawChart(dayReturnRates,dayReturnRateTicks) {\n  var data = google.visualization.arrayToDataTable(dayReturnRates);\n  var options = {\n    title: '',\n    hAxis: {textStyle:{fontSize:8},ticks:dayReturnRateTicks},\n    vAxis: {textStyle:{fontSize:8},minValue: 0,format:'#0.0'},    \n    colors:['#CC0000'],\n    legend:{position:'none'},\n    chartArea:{\n      width:280,\n      backgroundColor:{\n        stroke:'#000000',\n        strokeWidth:'1'\n      }\n    },\n    tooltip:{\n      trigger:'none'\n    }\n  };\n\n  var chart = new google.visualization.AreaChart(document.getElementById(\"fund-chart\"));\n  chart.draw(data, options);\n}\n      \nfunction ajaxLoadSingleFundAchievement(){\n  var deferred = $.Deferred();\n  var postdata = {};\n  postdata.fundId = filterXSS(sessionStorage.getItem(\"fundid\"));\n\t$.ajax({\n\t\turl: Constants.getSingleFundAchievementUrl(),\n      \ttype:\"GET\",\n      \tdata:postdata\n  \t}).done(function(response){\n  \t\tvar FundInfo = response;\n      var fmtFromEstablishHighestDate = (FundInfo.FromEstablishHighestDate) ? (new Date(FundInfo.FromEstablishHighestDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n      var fmtFromEstablishLowestDate = (FundInfo.FromEstablishLowestDate) ? (new Date(FundInfo.FromEstablishLowestDate)).format(\"yyyy/mm/dd\") : \"N/A\";\n\n      sessionStorage.setItem(\"fundCode\",FundInfo.FundCode);\n  \t\t$(\"#shortname\").html(FundInfo.FundShortName);\n  \t\t$(\"[data-role='moneytype']\").loadMoneyType(FundInfo.MoneyDividendTypes);\n\n      $(\"[data-role='page']\").css({\n        \"padding-top\":$(\"[data-role='header']\").outerHeight(true) + \"px\"\n      });\n\n      $(\"#select-fund\").loadSelectMoneyDividendTypes({\n        'moneyDividendTypes':FundInfo.MoneyDividendTypes,\n        'selectedValue':FundInfo.FundId\n      });\n      $(\"#select-interval\").loadFundIntervals({\n        'optionCaption' : '績效走勢',\n        'optionDivider' : '-'\n      });\n\n      $( \".tableAchievement\" ).html(function() {\n        var $this = $(this);\n        var table = {'thead':[],'tbody':[],'html':''};\n        var tableKey = $this.data(\"table-key\");\n        var dataTable = Constants.getAchievementMapping()[tableKey];\n\n        $.each(dataTable, function(index, item) {\n          var content = (FundInfo[item.Key]) ? FundInfo[item.Key] : \"N/A\";\n          content = (item.Key) ? content : \"\";\n\n          table.thead.push(\"<th>\" + item.Caption + \"</th>\");\n          table.tbody.push(\"<td>\");\n          table.tbody.push(\"  <span class='\" + $.cxRise(content) +  \"'>\" + content + \"</span>\");\n          table.tbody.push(\"</td>\");\n        });\n\n        table.thead.unshift(\"<thead>\");\n        table.thead.push(\"</thead>\");\n        table.tbody.unshift(\"<tbody>\");\n        table.tbody.push(\"</tbody>\");        \n        table.html = table.thead.join(\" \") + table.tbody.join(\" \");  \n        \n        return table.html;\n      });\n\n      $(\"#tableToNowAchievement\").loadMaxAndMinValueTable({\n        'tableCaption':'成立至今績效(%)',\n        'maxValue':FundInfo.FromEstablishHighest,\n        'maxValueDate' : fmtFromEstablishHighestDate,\n        'minValue' : FundInfo.FromEstablishLowest,\n        'minValueDate' : fmtFromEstablishLowestDate       \n      }); \n\n      deferred.resolve();\n\n\t  }).fail(function(jqXHR){\n      deferred.reject(jqXHR.responseJSON.Message);\n    });\t\n\n  return deferred.promise();\n}\n\n$(document).on(\"change\",\"#select-interval\",function(event){\n  App.StartLoading();\n  sessionStorage.setItem(\"interval\",$(this).val());\n  $.when(ajaxLoadChartAndFundReturnRateData()).done(function(){\n    App.StopLoading();      \n  }).fail(function(msg){\n    App.ShowAlert(msg,\"\",\"確定\",function(){\n      App.StopLoading();\n    });\n  });   \n});\n\n$(document).on(\"change\",\"#select-fund\",function(event){\n  App.StartLoading();\n  sessionStorage.setItem(\"fundid\",$(this).val()); \n  ajaxLoadSingleFundAchievement()\n    .then(function(){\n      ajaxLoadChartAndFundReturnRateData();\n    })\n    .done(function(){\n      App.StopLoading();\n    })\n    .fail(function(msg){\n      App.ShowAlert(msg,\"\",\"確定\",function(){\n        App.StopLoading();\n      });\n    });\n});\n\n$(document).on( \"pageinit\", \"#page-sfa\", function(event) {\n\n  App.StartLoading();\n\n  $(\".numura-warning\").loadWarning();\n\n  ajaxLoadSingleFundAchievement()\n    .then(function(){\n      ajaxLoadChartAndFundReturnRateData();\n    })\n    .done(function(){\n      App.StopLoading();\n    })\n    .fail(function(msg){\n      App.ShowAlert(msg,\"\",\"確定\",function(){\n        App.StopLoading();\n      });\n    });\n\n});"],"sourceRoot":"/source/"}